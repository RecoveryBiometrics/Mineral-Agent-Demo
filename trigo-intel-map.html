<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trigo Royalty · Mineral Intelligence</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@300;400;500&display=swap');

:root {
  --bg: #0c0f0a;
  --surface: #141810;
  --surface2: #1a1f14;
  --border: #252b1e;
  --border2: #2f3826;
  --text: #e8ead4;
  --text-dim: #5a6348;
  --text-mid: #8a9470;
  --gold: #c8a850;
  --gold-dim: #c8a85018;
  --gold-mid: #c8a85040;
  --green: #4a8c3f;
  --green-bright: #6ab85e;
  --green-dim: #4a8c3f18;
  --red: #c84040;
  --red-dim: #c8404018;
  --blue: #4878c8;
  --blue-dim: #4878c818;
  --trigo: #c8a850;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 12px;
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* TOP BAR */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  height: 52px;
  border-bottom: 1px solid var(--border);
  background: var(--surface);
  flex-shrink: 0;
  z-index: 1000;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
}

.brand-logo {
  font-family: 'Syne', sans-serif;
  font-size: 15px;
  font-weight: 800;
  color: var(--gold);
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.brand-divider {
  width: 1px;
  height: 18px;
  background: var(--border2);
}

.brand-sub {
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 0.15em;
  text-transform: uppercase;
}

.topbar-stats {
  display: flex;
  gap: 2px;
}

.stat-pill {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  border: 1px solid var(--border);
  background: var(--bg);
}

.stat-pill-num {
  font-family: 'Syne', sans-serif;
  font-size: 16px;
  font-weight: 700;
}

.stat-pill-num.gold { color: var(--gold); }
.stat-pill-num.green { color: var(--green-bright); }
.stat-pill-num.red { color: var(--red); }
.stat-pill-num.blue { color: var(--blue); }

.stat-pill-label {
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  line-height: 1.3;
}

.refresh-btn {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 0.1em;
  color: var(--bg);
  background: var(--gold);
  border: none;
  padding: 7px 16px;
  cursor: pointer;
  text-transform: uppercase;
  font-weight: 500;
  transition: all 0.15s;
}

.refresh-btn:hover { background: #dbb860; }

/* MAIN LAYOUT */
.main {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* LEFT PANEL */
.panel-left {
  width: 300px;
  flex-shrink: 0;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  background: var(--surface);
  overflow: hidden;
}

.panel-header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.panel-title {
  font-size: 9px;
  letter-spacing: 0.2em;
  color: var(--text-dim);
  text-transform: uppercase;
}

.panel-count {
  font-family: 'Syne', sans-serif;
  font-size: 11px;
  color: var(--gold);
  font-weight: 600;
}

.layer-controls {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.layer-toggle {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  padding: 6px 8px;
  transition: background 0.15s;
}

.layer-toggle:hover { background: var(--border); }

.layer-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.layer-dot.trigo { background: var(--gold); box-shadow: 0 0 6px var(--gold); }
.layer-dot.competitor { background: var(--red); box-shadow: 0 0 6px var(--red); }
.layer-dot.unleased { background: var(--green-bright); box-shadow: 0 0 6px var(--green-bright); }

.layer-name {
  font-size: 11px;
  color: var(--text);
  flex: 1;
}

.layer-badge {
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 2px;
}

.layer-badge.gold { background: var(--gold-dim); color: var(--gold); }
.layer-badge.red { background: var(--red-dim); color: var(--red); }
.layer-badge.green { background: var(--green-dim); color: var(--green-bright); }

.prospects-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.prospect-card {
  border: 1px solid var(--border);
  background: var(--bg);
  padding: 10px 12px;
  margin-bottom: 4px;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
}

.prospect-card:hover {
  border-color: var(--border2);
  background: var(--surface2);
}

.prospect-card.selected {
  border-color: var(--gold);
  background: var(--gold-dim);
}

.prospect-card.competitor-card {
  border-left: 2px solid var(--red);
}

.prospect-card.unleased-card {
  border-left: 2px solid var(--green-bright);
}

.prospect-card.trigo-card {
  border-left: 2px solid var(--gold);
}

.card-type {
  font-size: 8px;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: 4px;
}

.card-type.gold { color: var(--gold); }
.card-type.red { color: var(--red); }
.card-type.green { color: var(--green-bright); }

.card-name {
  font-family: 'Syne', sans-serif;
  font-size: 12px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 3px;
}

.card-detail {
  font-size: 10px;
  color: var(--text-mid);
  line-height: 1.6;
}

.card-detail span {
  color: var(--text-dim);
  margin-right: 4px;
}

.push-btn {
  width: 100%;
  margin-top: 8px;
  font-family: 'DM Mono', monospace;
  font-size: 9px;
  letter-spacing: 0.1em;
  color: var(--bg);
  background: var(--green-bright);
  border: none;
  padding: 5px;
  cursor: pointer;
  text-transform: uppercase;
  transition: all 0.15s;
  display: none;
}

.push-btn:hover { background: #7acc6e; }
.push-btn.visible { display: block; }
.push-btn.pushed { background: var(--border2); color: var(--text-dim); cursor: default; }

/* MAP */
#map {
  flex: 1;
  background: #0c0f0a;
}

/* RIGHT PANEL */
.panel-right {
  width: 280px;
  flex-shrink: 0;
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  background: var(--surface);
  overflow: hidden;
}

.detail-empty {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: var(--text-dim);
  gap: 8px;
  padding: 20px;
  text-align: center;
}

.detail-empty-icon {
  font-size: 32px;
  opacity: 0.3;
}

.detail-empty-text {
  font-size: 10px;
  letter-spacing: 0.1em;
  line-height: 1.6;
}

.detail-content {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: none;
}

.detail-content.visible { display: block; }

.detail-section {
  margin-bottom: 20px;
}

.detail-label {
  font-size: 8px;
  letter-spacing: 0.2em;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-bottom: 10px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
}

.detail-field {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  font-size: 11px;
  border-bottom: 1px solid var(--border);
}

.detail-field:last-child { border-bottom: none; }

.detail-key { color: var(--text-dim); }
.detail-val { color: var(--text); text-align: right; max-width: 150px; word-break: break-word; }
.detail-val.gold { color: var(--gold); font-weight: 500; }
.detail-val.green { color: var(--green-bright); }
.detail-val.red { color: var(--red); }

.action-buttons {
  padding: 12px 16px;
  border-top: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.action-btn {
  font-family: 'DM Mono', monospace;
  font-size: 10px;
  letter-spacing: 0.08em;
  border: 1px solid;
  padding: 8px;
  cursor: pointer;
  text-transform: uppercase;
  transition: all 0.15s;
  text-align: center;
}

.action-btn.primary {
  color: var(--bg);
  background: var(--green-bright);
  border-color: var(--green-bright);
}

.action-btn.primary:hover { background: #7acc6e; }

.action-btn.secondary {
  color: var(--gold);
  background: var(--gold-dim);
  border-color: var(--gold-mid);
}

.action-btn.secondary:hover { background: var(--gold-mid); }

.action-btn.tertiary {
  color: var(--text-mid);
  background: transparent;
  border-color: var(--border2);
}

.action-btn.tertiary:hover { background: var(--border); }

.action-btn.disabled {
  color: var(--text-dim);
  background: var(--border);
  border-color: var(--border);
  cursor: default;
}

/* BOTTOM STATUS */
.statusbar {
  height: 28px;
  border-top: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 20px;
  flex-shrink: 0;
}

.status-item {
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 0.1em;
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
}

.status-dot.live {
  background: var(--green-bright);
  box-shadow: 0 0 4px var(--green-bright);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Scrollbar */
::-webkit-scrollbar { width: 3px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); }

/* Custom map tiles dark */
.leaflet-tile {
  filter: brightness(0.4) saturate(0.3) hue-rotate(40deg) !important;
}

.leaflet-container {
  background: var(--bg) !important;
}

/* Custom markers */
.marker-trigo {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background: var(--gold);
  border: 2px solid #e8c860;
  box-shadow: 0 0 10px var(--gold), 0 0 20px var(--gold-mid);
}

.marker-competitor {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--red);
  border: 2px solid #e05050;
  box-shadow: 0 0 8px var(--red);
}

.marker-unleased {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--green-bright);
  border: 2px solid #7acc6e;
  box-shadow: 0 0 8px var(--green-bright);
}

.leaflet-popup-content-wrapper {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 0;
  box-shadow: 0 4px 20px rgba(0,0,0,0.6);
  color: var(--text);
  font-family: 'DM Mono', monospace;
  font-size: 11px;
}

.leaflet-popup-tip {
  background: var(--surface2);
}

.popup-title {
  font-family: 'Syne', sans-serif;
  font-size: 13px;
  font-weight: 700;
  margin-bottom: 6px;
}

.popup-row {
  display: flex;
  justify-content: space-between;
  gap: 12px;
  padding: 2px 0;
  font-size: 10px;
}

.popup-key { color: var(--text-dim); }
.popup-val { color: var(--text); }
.popup-val.gold { color: var(--gold); }
.popup-val.green { color: var(--green-bright); }
.popup-val.red { color: var(--red); }
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="brand">
    <div class="brand-logo">Trigo Royalty</div>
    <div class="brand-divider"></div>
    <div class="brand-sub">Mineral Intelligence · Reeves County, TX</div>
  </div>
  <div class="topbar-stats">
    <div class="stat-pill">
      <div>
        <div class="stat-pill-num gold" id="statWells">9</div>
        <div class="stat-pill-label">Trigo<br>Wells</div>
      </div>
    </div>
    <div class="stat-pill">
      <div>
        <div class="stat-pill-num red" id="statCompetitor">7</div>
        <div class="stat-pill-label">Competitor<br>Permits</div>
      </div>
    </div>
    <div class="stat-pill">
      <div>
        <div class="stat-pill-num green" id="statUnleased">14</div>
        <div class="stat-pill-label">Unleased<br>Owners</div>
      </div>
    </div>
    <div class="stat-pill">
      <div>
        <div class="stat-pill-num blue" id="statDays">48h</div>
        <div class="stat-pill-label">Avg Lead<br>Time</div>
      </div>
    </div>
  </div>
  <button class="refresh-btn" onclick="refreshData()">↺ Refresh Data</button>
</div>

<!-- MAIN -->
<div class="main">

  <!-- LEFT: Prospects List -->
  <div class="panel-left">
    <div class="panel-header">
      <div class="panel-title">Active Targets</div>
      <div class="panel-count" id="targetCount">30 Records</div>
    </div>

    <div class="layer-controls">
      <div class="layer-toggle" onclick="toggleLayer('trigo')">
        <div class="layer-dot trigo"></div>
        <div class="layer-name">Trigo Operated Wells</div>
        <div class="layer-badge gold">9</div>
      </div>
      <div class="layer-toggle" onclick="toggleLayer('competitor')">
        <div class="layer-dot competitor"></div>
        <div class="layer-name">Competitor Permits (30d)</div>
        <div class="layer-badge red">7</div>
      </div>
      <div class="layer-toggle" onclick="toggleLayer('unleased')">
        <div class="layer-dot unleased"></div>
        <div class="layer-name">Unleased Mineral Owners</div>
        <div class="layer-badge green">14</div>
      </div>
    </div>

    <div class="prospects-list" id="prospectsList">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- MAP -->
  <div id="map"></div>

  <!-- RIGHT: Detail Panel -->
  <div class="panel-right">
    <div class="panel-header">
      <div class="panel-title">Record Detail</div>
    </div>

    <div class="detail-empty" id="detailEmpty">
      <div class="detail-empty-icon">◎</div>
      <div class="detail-empty-text">Select a record from the list or click a map marker to view details</div>
    </div>

    <div class="detail-content" id="detailContent">
      <!-- Populated by JS -->
    </div>

    <div class="action-buttons" id="actionButtons" style="display:none">
      <!-- Populated by JS -->
    </div>
  </div>

</div>

<!-- STATUS BAR -->
<div class="statusbar">
  <div class="status-item">
    <div class="status-dot live"></div>
    RRC DATA LIVE
  </div>
  <div class="status-item">
    <div class="status-dot live"></div>
    REGRID API CONNECTED
  </div>
  <div class="status-item" style="margin-left: auto;">
    Last updated: <span style="color: var(--text-mid); margin-left: 4px;" id="lastUpdated">--</span>
  </div>
  <div class="status-item">
    Reeves County · Block 13, 54, 55 · Delaware Basin
  </div>
</div>

<script>
// ── DATA ────────────────────────────────────────────────────────
// Trigo's 9 operated wells with real API numbers and Reeves County coordinates
const trigoWells = [
  {
    id: 'TW1', type: 'trigo',
    name: 'EFG State 1H',
    api: '42-389-39516',
    operator: 'Trigo Exploration LLC',
    lat: 31.412, lng: -103.821,
    formation: 'Wolfcamp A',
    permit_date: '2019-03-14',
    status: 'PRODUCING',
    depth: '11,240 ft',
    county: 'Reeves',
    section: 'Sec 14, Blk 13'
  },
  {
    id: 'TW2', type: 'trigo',
    name: 'EFG State 2H',
    api: '42-389-39517',
    operator: 'Trigo Exploration LLC',
    lat: 31.415, lng: -103.818,
    formation: 'Wolfcamp A',
    permit_date: '2019-03-14',
    status: 'PRODUCING',
    depth: '11,240 ft',
    county: 'Reeves',
    section: 'Sec 14, Blk 13'
  },
  {
    id: 'TW3', type: 'trigo',
    name: 'Captain Ron State 1H',
    api: '42-389-39962',
    operator: 'Trigo Exploration LLC',
    lat: 31.398, lng: -103.845,
    formation: 'Wolfcamp B',
    permit_date: '2020-01-22',
    status: 'PRODUCING',
    depth: '12,100 ft',
    county: 'Reeves',
    section: 'Sec 21, Blk 13'
  },
  {
    id: 'TW4', type: 'trigo',
    name: 'Captain Ron State 2H',
    api: '42-389-39963',
    operator: 'Trigo Exploration LLC',
    lat: 31.401, lng: -103.842,
    formation: 'Wolfcamp B',
    permit_date: '2020-01-22',
    status: 'PRODUCING',
    depth: '12,100 ft',
    county: 'Reeves',
    section: 'Sec 21, Blk 13'
  },
  {
    id: 'TW5', type: 'trigo',
    name: 'Captain Ron State 3H',
    api: '42-389-40149',
    operator: 'Trigo Exploration LLC',
    lat: 31.404, lng: -103.839,
    formation: 'Wolfcamp A',
    permit_date: '2020-08-11',
    status: 'PRODUCING',
    depth: '11,800 ft',
    county: 'Reeves',
    section: 'Sec 21, Blk 13'
  },
  {
    id: 'TW6', type: 'trigo',
    name: 'EFG-Gus State 3H',
    api: '42-389-39716',
    operator: 'Trigo Exploration LLC',
    lat: 31.418, lng: -103.815,
    formation: 'Wolfcamp A',
    permit_date: '2019-09-03',
    status: 'PRODUCING',
    depth: '11,350 ft',
    county: 'Reeves',
    section: 'Sec 14, Blk 13'
  },
  {
    id: 'TW7', type: 'trigo',
    name: 'EFG-Gus State 4H',
    api: '42-389-40380',
    operator: 'Trigo Exploration LLC',
    lat: 31.421, lng: -103.812,
    formation: 'Wolfcamp B',
    permit_date: '2021-02-17',
    status: 'PRODUCING',
    depth: '12,200 ft',
    county: 'Reeves',
    section: 'Sec 14, Blk 13'
  },
  {
    id: 'TW8', type: 'trigo',
    name: 'EFG State 5H',
    api: '42-389-40279',
    operator: 'Trigo Exploration LLC',
    lat: 31.409, lng: -103.824,
    formation: 'Wolfcamp A',
    permit_date: '2020-11-30',
    status: 'PRODUCING',
    depth: '11,500 ft',
    county: 'Reeves',
    section: 'Sec 14, Blk 13'
  },
  {
    id: 'TW9', type: 'trigo',
    name: 'EFG State 6H',
    api: '42-389-40374',
    operator: 'Trigo Exploration LLC',
    lat: 31.406, lng: -103.827,
    formation: 'Wolfcamp B',
    permit_date: '2021-01-08',
    status: 'PRODUCING',
    depth: '12,050 ft',
    county: 'Reeves',
    section: 'Sec 14, Blk 13'
  }
];

// Competitor permits filed in last 30 days near Trigo operations
const competitorPermits = [
  {
    id: 'CP1', type: 'competitor',
    name: 'Permian Resources 14H',
    api: '42-389-41822',
    operator: 'Permian Resources Operating LLC',
    lat: 31.388, lng: -103.858,
    formation: 'Wolfcamp A',
    permit_date: '2026-02-03',
    days_ago: 21,
    county: 'Reeves',
    section: 'Sec 28, Blk 13',
    acres: 640
  },
  {
    id: 'CP2', type: 'competitor',
    name: 'Coterra Reeves 7H',
    api: '42-389-41901',
    operator: 'Coterra Energy Inc',
    lat: 31.435, lng: -103.798,
    formation: 'Wolfcamp B',
    permit_date: '2026-02-08',
    days_ago: 16,
    county: 'Reeves',
    section: 'Sec 8, Blk 13',
    acres: 480
  },
  {
    id: 'CP3', type: 'competitor',
    name: 'Coterra Reeves 8H',
    api: '42-389-41902',
    operator: 'Coterra Energy Inc',
    lat: 31.438, lng: -103.795,
    formation: 'Wolfcamp A',
    permit_date: '2026-02-08',
    days_ago: 16,
    county: 'Reeves',
    section: 'Sec 8, Blk 13',
    acres: 480
  },
  {
    id: 'CP4', type: 'competitor',
    name: 'Devon Energy 22H',
    api: '42-389-41955',
    operator: 'Devon Energy Production Co',
    lat: 31.375, lng: -103.871,
    formation: 'Wolfcamp A',
    permit_date: '2026-02-12',
    days_ago: 12,
    county: 'Reeves',
    section: 'Sec 35, Blk 13',
    acres: 560
  },
  {
    id: 'CP5', type: 'competitor',
    name: 'Mewbourne Oil 11H',
    api: '42-389-42001',
    operator: 'Mewbourne Oil Company',
    lat: 31.448, lng: -103.782,
    formation: 'Bone Spring',
    permit_date: '2026-02-17',
    days_ago: 7,
    county: 'Reeves',
    section: 'Sec 3, Blk 54',
    acres: 640
  },
  {
    id: 'CP6', type: 'competitor',
    name: 'Permian Resources 15H',
    api: '42-389-42044',
    operator: 'Permian Resources Operating LLC',
    lat: 31.385, lng: -103.862,
    formation: 'Wolfcamp B',
    permit_date: '2026-02-19',
    days_ago: 5,
    county: 'Reeves',
    section: 'Sec 28, Blk 13',
    acres: 640
  },
  {
    id: 'CP7', type: 'competitor',
    name: 'Occidental 33H',
    api: '42-389-42088',
    operator: 'Occidental Permian Ltd',
    lat: 31.362, lng: -103.884,
    formation: 'Wolfcamp A',
    permit_date: '2026-02-21',
    days_ago: 3,
    county: 'Reeves',
    section: 'Sec 42, Blk 13',
    acres: 720
  }
];

// Unleased mineral owners identified near competitor activity
const unleasedOwners = [
  {
    id: 'UO1', type: 'unleased',
    name: 'Margaret L. Patterson',
    address: '4821 Mockingbird Ln, Midland TX 79703',
    lat: 31.390, lng: -103.855,
    acres: 120,
    parcel: 'R000012481',
    section: 'Sec 28, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$84,000'
  },
  {
    id: 'UO2', type: 'unleased',
    name: 'Robert & Susan Wilkins',
    address: '1102 W Texas Ave, Midland TX 79701',
    lat: 31.386, lng: -103.861,
    acres: 80,
    parcel: 'R000012509',
    section: 'Sec 28, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$56,000'
  },
  {
    id: 'UO3', type: 'unleased',
    name: 'Heirs of Charles D. Monroe',
    address: 'Estate — Probate Research Needed',
    lat: 31.391, lng: -103.852,
    acres: 160,
    parcel: 'R000012534',
    section: 'Sec 28, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$112,000'
  },
  {
    id: 'UO4', type: 'unleased',
    name: 'Jerry Wayne Hutchins',
    address: '8834 Sagebrush Rd, Pecos TX 79772',
    lat: 31.437, lng: -103.797,
    acres: 40,
    parcel: 'R000018821',
    section: 'Sec 8, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$28,000'
  },
  {
    id: 'UO5', type: 'unleased',
    name: 'Dolores M. Sandoval',
    address: '2201 N Spring St, Roswell NM 88201',
    lat: 31.440, lng: -103.793,
    acres: 80,
    parcel: 'R000018844',
    section: 'Sec 8, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$56,000'
  },
  {
    id: 'UO6', type: 'unleased',
    name: 'First National Bank Trust Dept',
    address: 'PO Box 1440, Pecos TX 79772',
    lat: 31.436, lng: -103.800,
    acres: 200,
    parcel: 'R000018867',
    section: 'Sec 8, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$140,000'
  },
  {
    id: 'UO7', type: 'unleased',
    name: 'Thomas R. Hightower Jr.',
    address: '3317 Westbrook Ave, Amarillo TX 79109',
    lat: 31.374, lng: -103.873,
    acres: 160,
    parcel: 'R000024412',
    section: 'Sec 35, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$112,000'
  },
  {
    id: 'UO8', type: 'unleased',
    name: 'Brenda Kay Morrison',
    address: '7741 Canyon Rd, Lubbock TX 79413',
    lat: 31.377, lng: -103.869,
    acres: 40,
    parcel: 'R000024438',
    section: 'Sec 35, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$28,000'
  },
  {
    id: 'UO9', type: 'unleased',
    name: 'Garcia Family Minerals LLC',
    address: '4500 N Mesa St Ste 200, El Paso TX 79912',
    lat: 31.449, lng: -103.780,
    acres: 320,
    parcel: 'R000031122',
    section: 'Sec 3, Blk 54',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$224,000'
  },
  {
    id: 'UO10', type: 'unleased',
    name: 'Billy Joe Carmichael',
    address: '1891 Ranch Rd 2965, Fort Stockton TX 79735',
    lat: 31.452, lng: -103.777,
    acres: 80,
    parcel: 'R000031145',
    section: 'Sec 3, Blk 54',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$56,000'
  },
  {
    id: 'UO11', type: 'unleased',
    name: 'Connie Jo Whitfield',
    address: '512 W Callaghan St, Fort Stockton TX 79735',
    lat: 31.446, lng: -103.785,
    acres: 40,
    parcel: 'R000031167',
    section: 'Sec 3, Blk 54',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$28,000'
  },
  {
    id: 'UO12', type: 'unleased',
    name: 'Harold & Norma Jean Bass',
    address: '2244 S Permian Ave, Hobbs NM 88240',
    lat: 31.363, lng: -103.882,
    acres: 120,
    parcel: 'R000037891',
    section: 'Sec 42, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$84,000'
  },
  {
    id: 'UO13', type: 'unleased',
    name: 'Permian Royalties Trust',
    address: 'c/o Southwest Securities, Dallas TX 75201',
    lat: 31.360, lng: -103.886,
    acres: 240,
    parcel: 'R000037912',
    section: 'Sec 42, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$168,000'
  },
  {
    id: 'UO14', type: 'unleased',
    name: 'Deborah Ann Trevino',
    address: '8821 Cactus Flower Dr, San Antonio TX 78251',
    lat: 31.365, lng: -103.879,
    acres: 80,
    parcel: 'R000037934',
    section: 'Sec 42, Blk 13',
    county: 'Reeves',
    lease_status: 'UNLEASED',
    last_contact: 'Never',
    source: 'Reeves CAD Mineral Roll',
    appraisal: '$56,000'
  }
];

const allRecords = [...trigoWells, ...competitorPermits, ...unleasedOwners];
let selectedId = null;
let pushedToGHL = new Set();
let layerVisibility = { trigo: true, competitor: true, unleased: true };
let markers = {};

// ── MAP INIT ─────────────────────────────────────────────────────
const map = L.map('map', {
  center: [31.41, -103.83],
  zoom: 12,
  zoomControl: false
});

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap',
  maxZoom: 18
}).addTo(map);

L.control.zoom({ position: 'bottomright' }).addTo(map);

function createIcon(type) {
  const colors = {
    trigo: { bg: '#c8a850', border: '#e8c860', size: 14 },
    competitor: { bg: '#c84040', border: '#e05050', size: 12 },
    unleased: { bg: '#6ab85e', border: '#7acc6e', size: 10 }
  };
  const c = colors[type];
  return L.divIcon({
    className: '',
    html: `<div style="width:${c.size}px;height:${c.size}px;border-radius:50%;background:${c.bg};border:2px solid ${c.border};box-shadow:0 0 8px ${c.bg};"></div>`,
    iconSize: [c.size, c.size],
    iconAnchor: [c.size/2, c.size/2]
  });
}

function getPopupContent(r) {
  if (r.type === 'trigo') {
    return `<div class="popup-title" style="color:#c8a850">${r.name}</div>
      <div class="popup-row"><span class="popup-key">API #</span><span class="popup-val gold">${r.api}</span></div>
      <div class="popup-row"><span class="popup-key">Formation</span><span class="popup-val">${r.formation}</span></div>
      <div class="popup-row"><span class="popup-key">Status</span><span class="popup-val green">${r.status}</span></div>
      <div class="popup-row"><span class="popup-key">Section</span><span class="popup-val">${r.section}</span></div>`;
  } else if (r.type === 'competitor') {
    return `<div class="popup-title" style="color:#c84040">${r.name}</div>
      <div class="popup-row"><span class="popup-key">Operator</span><span class="popup-val">${r.operator}</span></div>
      <div class="popup-row"><span class="popup-key">Filed</span><span class="popup-val red">${r.days_ago} days ago</span></div>
      <div class="popup-row"><span class="popup-key">Formation</span><span class="popup-val">${r.formation}</span></div>
      <div class="popup-row"><span class="popup-key">Unit Acres</span><span class="popup-val">${r.acres}</span></div>`;
  } else {
    return `<div class="popup-title" style="color:#6ab85e">${r.name}</div>
      <div class="popup-row"><span class="popup-key">Address</span><span class="popup-val">${r.address.split(',')[0]}</span></div>
      <div class="popup-row"><span class="popup-key">Acres</span><span class="popup-val green">${r.acres} ac</span></div>
      <div class="popup-row"><span class="popup-key">Status</span><span class="popup-val green">UNLEASED ✓</span></div>
      <div class="popup-row"><span class="popup-key">Appraisal</span><span class="popup-val">${r.appraisal}</span></div>`;
  }
}

function plotMarkers() {
  allRecords.forEach(r => {
    if (markers[r.id]) {
      map.removeLayer(markers[r.id]);
    }
    if (!layerVisibility[r.type]) return;

    const m = L.marker([r.lat, r.lng], { icon: createIcon(r.type) })
      .addTo(map)
      .bindPopup(getPopupContent(r), { maxWidth: 220 });

    m.on('click', () => selectRecord(r.id));
    markers[r.id] = m;
  });
}

// ── SIDEBAR LIST ─────────────────────────────────────────────────
function buildList() {
  const list = document.getElementById('prospectsList');
  list.innerHTML = '';

  const sections = [
    { label: 'TRIGO OPERATED WELLS', records: trigoWells, cls: 'trigo-card', typeCls: 'gold', typeLabel: 'TRIGO OPERATED' },
    { label: 'COMPETITOR PERMITS — LAST 30 DAYS', records: competitorPermits, cls: 'competitor-card', typeCls: 'red', typeLabel: 'COMPETITOR PERMIT' },
    { label: 'UNLEASED MINERAL OWNERS', records: unleasedOwners, cls: 'unleased-card', typeCls: 'green', typeLabel: 'UNLEASED OWNER' }
  ];

  sections.forEach(sec => {
    if (!layerVisibility[sec.records[0]?.type]) return;

    const header = document.createElement('div');
    header.style.cssText = 'font-size:8px;letter-spacing:.2em;color:var(--text-dim);padding:10px 8px 4px;text-transform:uppercase;';
    header.textContent = sec.label;
    list.appendChild(header);

    sec.records.forEach(r => {
      const card = document.createElement('div');
      card.className = `prospect-card ${sec.cls}`;
      card.id = `card-${r.id}`;

      let subtitle = '';
      if (r.type === 'trigo') subtitle = `${r.formation} · ${r.section}`;
      if (r.type === 'competitor') subtitle = `${r.operator.split(' ')[0]} · ${r.days_ago}d ago · ${r.acres} ac`;
      if (r.type === 'unleased') subtitle = `${r.acres} ac · ${r.section}`;

      const isPushed = pushedToGHL.has(r.id);

      card.innerHTML = `
        <div class="card-type ${sec.typeCls}">${sec.typeLabel}</div>
        <div class="card-name">${r.name}</div>
        <div class="card-detail">${subtitle}</div>
        ${r.type === 'unleased' ? `<button class="push-btn visible ${isPushed ? 'pushed' : ''}" id="pushbtn-${r.id}" onclick="pushToGHL('${r.id}', event)">${isPushed ? '✓ IN GHL' : '+ Push to GHL'}</button>` : ''}
      `;

      card.addEventListener('click', (e) => {
        if (e.target.classList.contains('push-btn')) return;
        selectRecord(r.id);
      });

      list.appendChild(card);
    });
  });
}

// ── SELECT RECORD ─────────────────────────────────────────────────
function selectRecord(id) {
  selectedId = id;
  const r = allRecords.find(x => x.id === id);
  if (!r) return;

  // Update card highlighting
  document.querySelectorAll('.prospect-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById(`card-${id}`);
  if (card) {
    card.classList.add('selected');
    card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }

  // Pan map to marker
  if (markers[id]) {
    map.panTo([r.lat, r.lng]);
    markers[id].openPopup();
  }

  // Show detail panel
  document.getElementById('detailEmpty').style.display = 'none';
  const content = document.getElementById('detailContent');
  const actions = document.getElementById('actionButtons');
  content.classList.add('visible');
  actions.style.display = 'flex';
  actions.style.flexDirection = 'column';
  actions.style.gap = '6px';

  content.innerHTML = buildDetailHTML(r);
  actions.innerHTML = buildActionsHTML(r);
}

function buildDetailHTML(r) {
  if (r.type === 'trigo') {
    return `
      <div class="detail-section">
        <div class="detail-label">Well Information</div>
        <div class="detail-field"><span class="detail-key">Well Name</span><span class="detail-val gold">${r.name}</span></div>
        <div class="detail-field"><span class="detail-key">API Number</span><span class="detail-val">${r.api}</span></div>
        <div class="detail-field"><span class="detail-key">Operator</span><span class="detail-val">Trigo Exploration</span></div>
        <div class="detail-field"><span class="detail-key">Status</span><span class="detail-val green">${r.status}</span></div>
        <div class="detail-field"><span class="detail-key">Formation</span><span class="detail-val">${r.formation}</span></div>
        <div class="detail-field"><span class="detail-key">TD Depth</span><span class="detail-val">${r.depth}</span></div>
        <div class="detail-field"><span class="detail-key">Permit Date</span><span class="detail-val">${r.permit_date}</span></div>
        <div class="detail-field"><span class="detail-key">Section</span><span class="detail-val">${r.section}</span></div>
        <div class="detail-field"><span class="detail-key">County</span><span class="detail-val">${r.county}</span></div>
        <div class="detail-field"><span class="detail-key">Coordinates</span><span class="detail-val">${r.lat.toFixed(4)}, ${r.lng.toFixed(4)}</span></div>
      </div>`;
  } else if (r.type === 'competitor') {
    return `
      <div class="detail-section">
        <div class="detail-label">Competitor Permit</div>
        <div class="detail-field"><span class="detail-key">Well Name</span><span class="detail-val red">${r.name}</span></div>
        <div class="detail-field"><span class="detail-key">API Number</span><span class="detail-val">${r.api}</span></div>
        <div class="detail-field"><span class="detail-key">Operator</span><span class="detail-val">${r.operator}</span></div>
        <div class="detail-field"><span class="detail-key">Filed</span><span class="detail-val red">${r.days_ago} days ago</span></div>
        <div class="detail-field"><span class="detail-key">Permit Date</span><span class="detail-val">${r.permit_date}</span></div>
        <div class="detail-field"><span class="detail-key">Formation</span><span class="detail-val">${r.formation}</span></div>
        <div class="detail-field"><span class="detail-key">Unit Acres</span><span class="detail-val">${r.acres}</span></div>
        <div class="detail-field"><span class="detail-key">Section</span><span class="detail-val">${r.section}</span></div>
        <div class="detail-field"><span class="detail-key">County</span><span class="detail-val">${r.county}</span></div>
      </div>
      <div class="detail-section">
        <div class="detail-label">Acquisition Alert</div>
        <div style="font-size:11px;color:var(--text-mid);line-height:1.7;">Unleased owners in ${r.section} are now under active development pressure. Contact immediately before ${r.operator.split(' ')[0]} secures remaining acreage.</div>
      </div>`;
  } else {
    const isPushed = pushedToGHL.has(r.id);
    return `
      <div class="detail-section">
        <div class="detail-label">Mineral Owner</div>
        <div class="detail-field"><span class="detail-key">Owner</span><span class="detail-val green">${r.name}</span></div>
        <div class="detail-field"><span class="detail-key">Mailing Address</span><span class="detail-val">${r.address}</span></div>
        <div class="detail-field"><span class="detail-key">Acres</span><span class="detail-val">${r.acres} ac</span></div>
        <div class="detail-field"><span class="detail-key">Parcel ID</span><span class="detail-val">${r.parcel}</span></div>
        <div class="detail-field"><span class="detail-key">Section</span><span class="detail-val">${r.section}</span></div>
        <div class="detail-field"><span class="detail-key">Lease Status</span><span class="detail-val green">UNLEASED</span></div>
        <div class="detail-field"><span class="detail-key">Last Contact</span><span class="detail-val">${r.last_contact}</span></div>
        <div class="detail-field"><span class="detail-key">Data Source</span><span class="detail-val">${r.source}</span></div>
        <div class="detail-field"><span class="detail-key">CAD Appraisal</span><span class="detail-val gold">${r.appraisal}</span></div>
        <div class="detail-field"><span class="detail-key">GHL Status</span><span class="detail-val ${isPushed ? 'green' : ''}">${isPushed ? 'IN PIPELINE ✓' : 'NOT ADDED'}</span></div>
      </div>`;
  }
}

function buildActionsHTML(r) {
  const isPushed = pushedToGHL.has(r.id);
  if (r.type === 'unleased') {
    return `
      <button class="action-btn primary ${isPushed ? 'disabled' : ''}" onclick="pushToGHL('${r.id}', event)">
        ${isPushed ? '✓ Added to GHL Pipeline' : '+ Push to GHL · Start Outreach'}
      </button>
      <button class="action-btn secondary" onclick="copyAddress('${r.id}')">⊡ Copy Mailing Address</button>
      <button class="action-btn tertiary" onclick="alert('Opening Reeves CAD record...')">↗ View CAD Record</button>`;
  } else if (r.type === 'competitor') {
    return `
      <button class="action-btn primary" onclick="findUnleased('${r.id}')">⊕ Find Unleased Owners Nearby</button>
      <button class="action-btn tertiary" onclick="alert('Opening RRC permit record...')">↗ View RRC Permit</button>`;
  } else {
    return `<button class="action-btn tertiary" onclick="alert('Opening RRC well record...')">↗ View RRC Well Record</button>`;
  }
}

// ── ACTIONS ───────────────────────────────────────────────────────
function pushToGHL(id, e) {
  if (e) e.stopPropagation();
  if (pushedToGHL.has(id)) return;

  pushedToGHL.add(id);

  const btn = document.getElementById(`pushbtn-${id}`);
  if (btn) {
    btn.textContent = '✓ IN GHL';
    btn.classList.add('pushed');
  }

  // Flash confirmation
  const r = allRecords.find(x => x.id === id);
  showToast(`✓ ${r.name} added to GHL · Mailer sequence triggered`);

  // Refresh detail if this record is selected
  if (selectedId === id) {
    selectRecord(id);
  }
}

function copyAddress(id) {
  const r = allRecords.find(x => x.id === id);
  if (r && r.address) {
    navigator.clipboard.writeText(r.address).catch(() => {});
    showToast(`Address copied: ${r.address}`);
  }
}

function findUnleased(id) {
  const r = allRecords.find(x => x.id === id);
  showToast(`Searching for unleased owners near ${r.section}...`);
  setTimeout(() => {
    document.getElementById('layerUnleased')?.click();
  }, 500);
}

function toggleLayer(type) {
  layerVisibility[type] = !layerVisibility[type];
  plotMarkers();
  buildList();
}

function refreshData() {
  const btn = document.querySelector('.refresh-btn');
  btn.textContent = '↺ Refreshing...';
  btn.disabled = true;
  setTimeout(() => {
    document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
    btn.textContent = '↺ Refresh Data';
    btn.disabled = false;
    showToast('✓ Data refreshed · RRC + Regrid APIs called');
  }, 1800);
}

function showToast(msg) {
  const toast = document.createElement('div');
  toast.style.cssText = `
    position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
    background: var(--surface2); border: 1px solid var(--gold-mid);
    color: var(--text); font-family: 'DM Mono', monospace; font-size: 11px;
    padding: 10px 20px; z-index: 9999; letter-spacing: 0.05em;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5); animation: fadeIn 0.2s forwards;
  `;
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ── INIT ──────────────────────────────────────────────────────────
plotMarkers();
buildList();
document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();

// Auto select first unleased owner for demo
setTimeout(() => selectRecord('UO1'), 800);
</script>
</body>
</html>
